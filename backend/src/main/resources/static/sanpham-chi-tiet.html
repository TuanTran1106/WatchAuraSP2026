<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi tiết Sản Phẩm</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #ddd;
        }

        .header h1 {
            font-size: 28px;
            color: #333;
        }

        .back-btn {
            padding: 10px 20px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .back-btn:hover {
            background-color: #5a6268;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }

        .image-section {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .product-image {
            max-width: 100%;
            width: 100%;
            max-height: 500px;
            object-fit: contain;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 20px;
            background-color: #f9f9f9;
        }

        .info-section {
            display: flex;
            flex-direction: column;
        }

        .info-group {
            margin-bottom: 25px;
        }

        .info-label {
            font-weight: bold;
            color: #555;
            font-size: 14px;
            text-transform: uppercase;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }

        .info-value {
            color: #333;
            font-size: 16px;
            padding: 12px;
            background-color: #f9f9f9;
            border-left: 3px solid #007bff;
            border-radius: 4px;
        }

        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            width: fit-content;
        }

        .status-active {
            background-color: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background-color: #f8d7da;
            color: #721c24;
        }

        .description {
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #666;
        }

        .error {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .header h1 {
                font-size: 22px;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>CHI TIẾT SẢN PHẨM</h1>
        <button class="back-btn" onclick="goBack()">← Quay lại</button>
    </div>

    <div id="error-message"></div>
    <div id="loading" class="loading">Đang tải dữ liệu...</div>
    <div id="content" style="display: none;">
        <div class="content">
            <div class="image-section">
                <img id="productImage" src="" alt="Ảnh sản phẩm" class="product-image">
            </div>

            <div class="info-section">
                <div class="info-group">
                    <div class="info-label">Mã sản phẩm</div>
                    <div class="info-value" id="maSanPham"></div>
                </div>

                <div class="info-group">
                    <div class="info-label">Tên sản phẩm</div>
                    <div class="info-value" id="tenSanPham" style="font-size: 18px; font-weight: bold;"></div>
                </div>

                <div class="info-group">
                    <div class="info-label">Thương hiệu</div>
                    <div class="info-value" id="tenThuongHieu"></div>
                </div>

                <div class="info-group">
                    <div class="info-label">Danh mục</div>
                    <div class="info-value" id="tenDanhMuc"></div>
                </div>

                <div class="info-group">
                    <div class="info-label">Phong cách</div>
                    <div class="info-value" id="phongCach"></div>
                </div>

                <div class="info-group">
                    <div class="info-label">Trạng thái</div>
                    <div class="info-value" id="trangThai"></div>
                </div>
            </div>
        </div>

        <div class="info-group" style="margin-top: 30px; padding-top: 30px; border-top: 2px solid #ddd;">
            <div class="info-label">Mô tả chi tiết</div>
            <div class="info-value description" id="moTa"></div>
        </div>

        <div id="detailsTable" style="margin-top: 30px; padding-top: 30px; border-top: 2px solid #ddd;">
            <div class="info-label">CHI TIẾT BIẾN THỂ SẢN PHẨM</div>
            <table border="1" cellpadding="10" cellspacing="0" style="width: 100%; margin-top: 15px;">
                <thead>
                    <tr style="background-color: #f0f0f0;">
                        <th>ID</th>
                        <th>Màu sắc</th>
                        <th>Kích thước</th>
                        <th>Chất liệu dây</th>
                        <th>Loại máy</th>
                        <th>Giá bán</th>
                        <th>Đường kính (mm)</th>
                        <th>Độ chịu nước (m)</th>
                        <th>Bề rộng dây (mm)</th>
                        <th>Trọng lượng (g)</th>
                        <th>Số lượng tồn</th>
                        <th>Trạng thái</th>
                    </tr>
                </thead>
                <tbody id="detailsTableBody">
                    <tr><td colspan="12" style="text-align: center; padding: 20px;">Đang tải...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const API_URL = 'http://localhost:8080/api';

    // Lấy ID sản phẩm từ URL
    function getProductIdFromUrl() {
        const params = new URLSearchParams(window.location.search);
        return params.get('id');
    }

    // Quay lại trang danh sách
    function goBack() {
        window.location.href = 'sanpham.html';
    }

    // Load chi tiết sản phẩm
    async function loadProductDetail() {
        const productId = getProductIdFromUrl();

        if (!productId) {
            showError('Không tìm thấy sản phẩm');
            return;
        }

        try {
            const response = await fetch(`${API_URL}/san-pham/${productId}`);

            if (!response.ok) {
                showError('Không tìm thấy sản phẩm');
                return;
            }

            const product = await response.json();
            displayProductDetail(product);
            
            // Load chi tiết biến thể sản phẩm
            loadProductVariants(productId);
        } catch (error) {
            console.error('Lỗi:', error);
            showError('Lỗi khi tải dữ liệu sản phẩm');
        }
    }

    // Load danh sách chi tiết sản phẩm
    async function loadProductVariants(productId) {
        try {
            const response = await fetch(`${API_URL}/san-pham-chi-tiet/san-pham/${productId}`);

            if (!response.ok) {
                // Nếu không có chi tiết, ẩn bảng
                const detailsTable = document.getElementById('detailsTable');
                if (detailsTable) {
                    detailsTable.style.display = 'none';
                }
                return;
            }

            const variants = await response.json();
            displayProductVariants(variants);
        } catch (error) {
            console.error('Lỗi khi tải chi tiết sản phẩm:', error);
            const detailsTable = document.getElementById('detailsTable');
            if (detailsTable) {
                detailsTable.style.display = 'none';
            }
        }
    }

    // Hiển thị danh sách chi tiết sản phẩm
    function displayProductVariants(variants) {
        const tbody = document.getElementById('detailsTableBody');

        if (!variants || variants.length === 0) {
            tbody.innerHTML = '<tr><td colspan="12" style="text-align: center;">Không có chi tiết sản phẩm</td></tr>';
            return;
        }

        tbody.innerHTML = variants.map(v => `
            <tr>
                <td>${v.id}</td>
                <td>${v.tenMauSac || 'N/A'}</td>
                <td>${v.tenKichThuoc || 'N/A'}</td>
                <td>${v.tenChatLieuDay || 'N/A'}</td>
                <td>${v.tenLoaiMay || 'N/A'}</td>
                <td>${formatPrice(v.giaBan)}</td>
                <td>${v.duongKinh || 'N/A'}</td>
                <td>${v.doChiuNuoc || 'N/A'}</td>
                <td>${v.beRongDay || 'N/A'}</td>
                <td>${v.trongLuong || 'N/A'}</td>
                <td>${v.soLuongTon || 0}</td>
                <td>${v.trangThai ? 'Hoạt động' : 'Không hoạt động'}</td>
            </tr>
        `).join('');
    }

    // Format giá tiền
    function formatPrice(price) {
        if (!price) return '0₫';
        return parseFloat(price).toLocaleString('vi-VN') + '₫';
    }

    // Hiển thị thông tin sản phẩm
    function displayProductDetail(product) {
        // Hiển thị ảnh
        const imageElement = document.getElementById('productImage');
        if (product.hinhAnh) {
            imageElement.src = product.hinhAnh;
            imageElement.alt = product.tenSanPham;
        } else {
            imageElement.src = 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="300" height="300"%3E%3Crect width="300" height="300" fill="%23ddd"/%3E%3Ctext x="50%25" y="50%25" font-size="18" fill="%23999" text-anchor="middle" dy=".3em"%3EKhông có ảnh%3C/text%3E%3C/svg%3E';
        }

        // Hiển thị thông tin
        document.getElementById('maSanPham').textContent = product.maSanPham || 'N/A';
        document.getElementById('tenSanPham').textContent = product.tenSanPham || 'N/A';
        document.getElementById('tenThuongHieu').textContent = product.tenThuongHieu || 'N/A';
        document.getElementById('tenDanhMuc').textContent = product.tenDanhMuc || 'N/A';
        document.getElementById('phongCach').textContent = product.phongCach || 'N/A';
        document.getElementById('moTa').textContent = product.moTa || 'Không có mô tả';

        // Hiển thị trạng thái
        const statusElement = document.getElementById('trangThai');
        if (product.trangThai) {
            statusElement.innerHTML = '<span class="status-badge status-active">Hoạt động</span>';
        } else {
            statusElement.innerHTML = '<span class="status-badge status-inactive">Không hoạt động</span>';
        }

        // Ẩn loading, hiển thị content
        document.getElementById('loading').style.display = 'none';
        document.getElementById('content').style.display = 'block';
    }

    // Hiển thị lỗi
    function showError(message) {
        const errorDiv = document.getElementById('error-message');
        errorDiv.innerHTML = `<div class="error">${message}</div>`;
        document.getElementById('loading').style.display = 'none';
    }

    // Khởi tạo khi trang load
    window.onload = function() {
        loadProductDetail();
    };
</script>
</body>
</html>
